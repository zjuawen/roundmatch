<!--miniprogram/pages/matches/detail.wxml-->

<mp-navigation-bar loading="{{loading}}" show="{{true}}" animated="{{animated}}" color="{{/*'red'*/}}" background="{{'white'}}" title="{{title}}" back="{{true}}"></mp-navigation-bar>

<button 
	wx:if="{{action=='new'}}" 
	class="weui-btn" type="primary" 
  style="margin-top: 20rpx" 
  bindtap="onSaveMatch">
	保存
</button>

<view style="margin-bottom:70px" >

  <!-- games -->
  <view wx:if="{{tabIndex==0}}" >

    <view 
      wx:for="{{games}}"
      wx:key="{item._id}"
      wx:for-index="index" 
      class="uploader"
      style="flex-direction: row;align-items: center; padding-left: 10rpx; padding-right: 10rpx; margin-top: 20rpx; background-color: {{(item.score1>=0 && item.score2>=0)? 'lightgreen' : 'white' }}; ">

      <label 
        style="border: none; flex: 1; text-align: center;" > 
        {{(index+1)}}
      </label>

      <label 
        style="border: none; flex: 3; text-align: center; font-size: 32rpx;" > 
        {{item.playerName1}}
      </label>
      <label 
        style="border: none; flex: 3; text-align: center; font-size: 32rpx;" > 
        {{item.playerName2}}
      </label>

      <button 
        wx:if="{{(item.score1<0 || item.score2<0)}}"
        type="default" 
        size="mini" 
        plain="{{true}}"
        disabled="{{disabled}}" 
        bindtap="onClickScore"
        data-id="{{item._id}}" 
        data-index="{{index}}" 
        style="border: none; flex: 2" > 
        vs
      </button>

      <button 
        wx:if="{{(item.score1>=0 && item.score2>=0)}}"
        type="default"
        size="mini" 
        plain="{{true}}"
        disabled="{{disabled}}" 
        data-id="{{item._id}}" 
        data-index="{{index}}" 
        bindtap="onClickNone"
        bindlongpress="onLongPressScore"
        style="border: none; flex: 2" > 
        {{item.score1}}:{{item.score2}}
      </button>
      
      <label 
        style="border: none; flex: 3; text-align: center; font-size: 32rpx;" > 
        {{item.playerName3}}
      </label>
      <label 
        style="border: none; flex: 3; text-align: center; font-size: 32rpx;" > 
        {{item.playerName4}}
      </label>
        
    </view>

  </view>

  <!-- stats -->
  <view wx:if="{{tabIndex==1}}" >

    <!-- header -->
    <view 
      style="display: flex; direction: row;align-items: center; padding-left: 0rpx; margin-top: 20rpx;" >

      <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >No.</label >

      <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >姓名</label >

      <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >胜场数</label>

      <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >负场数</label>

      <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >净胜球</label>
      
      <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >总得分</label>

    </view>

    <view 
      wx:for="{{matchPlayers}}"
      wx:key="{item._id}"
      wx:for-index="index" 
      class="uploader"
      style="flex-direction: row;align-items: center; padding-left: 0rpx; margin-top: 20rpx;" >

      <label 
        wx:if="{{(!matchDone || (index!=0 && (index!=matchPlayers.length-1)))}}" 
        style="border: none; flex: 1; text-align: center;" > 
        {{index+1}}
      </label >

      <image wx:if="{{(matchDone && (index==0))}}" 
        src="../../images/crown.png" mode="aspectFit"
        style="height: 50rpx; width: 50rpx; flex: 1;" >
      </image>

      <image wx:if="{{(matchDone && (index==matchPlayers.length-1))}}" 
        src="../../images/pighead.png" mode="aspectFit"
        style="height: 50rpx; width: 50rpx; flex: 1;" >
      </image>

      <label style="border: none; flex: 1; text-align: center; font-size: 32rpx;" > 
        {{item.name}}
      </label >

      <label style="border: none; flex: 1; text-align: center;" > 
        {{item.win}}
      </label>

      <label style="border: none; flex: 1; text-align: center;" > 
        {{item.lost}}
      </label>

      <label style="border: none; flex: 1; text-align: center;" > 
        {{item.delta}}
      </label>
      
      <label style="border: none; flex: 1; text-align: center;" > 
        {{item.total}}
      </label>

    </view>

  </view>

</view>

<mp-tabbar 
  wx:if="{{saved}}"
  style="position:fixed;bottom:0;width:100%;left:0;right:0;" 
  list="{{list}}"  bindchange="tabChange" >
  </mp-tabbar>

<mp-dialog 
  title="比分" 
  show="{{dialogShow}}" 
  bindbuttontap="tapDialogButton" 
  buttons="{{dialogBtns}}">

  <view style="display: flex; flex-direction: column;">  
    <view style="display: flex; flex-direction: row; margin-bottom: 20px; justify-content: center;">  
      <input 
        style="background-color: #EEE; width: 30%; flex: 3; height: 30px; font-size: 20px; padding-top: 5px; " type="number" value="{{(tempScore1<0?'':tempScore1)}}" 
        bindchange="inputScore1" focus="true" ></input>
      <text style="flex: 1; padding-top: 5px; ">:</text>
      <input 
        style="background-color: #EEE; width: 30%; flex: 3; height: 30px; font-size: 20px; padding-top: 5px; " type="number" value="{{(tempScore2<0?'':tempScore2)}}" 
        bindchange="inputScore2" ></input>
    </view>    
    <view style="display: flex; flex-direction: row; justify-content: center;">  
      <view style="flex: 4" >
        <text>{{games[clickIndex].playerName1}} {{games[clickIndex].playerName2}}</text>
      </view>
      <text style="flex: 1" >/</text>
      <view style="flex: 4" >
        <text>{{games[clickIndex].playerName3}} {{games[clickIndex].playerName4}}</text>
      </view>
    </view>
  </view>
</mp-dialog>