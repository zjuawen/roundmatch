<!--miniprogram/pages/matches/detail.wxml-->

<mp-navigation-bar loading="{{loading}}" show="{{true}}" animated="{{animated}}" color="{{/*'red'*/}}" background="{{'white'}}" title="{{title}}" back="{{true}}"></mp-navigation-bar>

<button 
	wx:if="{{action=='new'}}" 
	class="weui-btn" 
  type="primary" size="mini"
  style="margin-top: 20rpx" 
  bindtap="onSaveMatch">
	保存
</button>

<view style="margin-bottom:70px" >

  <!-- games -->
  <view wx:if="{{tabIndex==0}}" >

    <view 
      wx:for="{{games}}"
      wx:key="{item._id}"
      wx:for-index="index" 
      class="detail-block"
      style="background-color: {{(item.score1>=0 && item.score2>=0)? '#DDFFDD' : 'white' }};" >

      <view class="detail-title">
        <image class="detail-title-icon" 
          src="../../images/clock.svg" >
          </image>
        <view class="detail-title-text" >2018-11-13</view>
      </view> 

      <!-- detail-content -->
      <view class="detail-content">
        
        <!-- <label 
          style="border: none; flex: 1; text-align: center;" > 
          {{(index+1)}}
        </label> -->

        <!-- column1 -->
        <view class="detail-content-column">
          <view class="detail-content-avatars">
            <image 
              class="avatar" 
              src="{{item.playerInfo1.avatarUrl}}" >
              </image>
            <image class="avatar" 
              src="{{item.playerInfo2.avatarUrl}}" >
              </image> 
          </view>
          <view class="detail-content-names">
            <view class="detail-content-name">
              {{item.playerInfo1.name}}
            </view>
            <view class="detail-content-name">
              {{item.playerInfo2.name}}
            </view>        
          </view>
        </view>

        <!-- column2 -->
        <view class="detail-content-column">
          <view 
            wx:if="{{(item.score1<0 || item.score2<0)}}"
            disabled="{{vsBtnDisable}}" 
            data-id="{{item._id}}" 
            data-index="{{index}}" 
            bindtap="onClickScore"
            class="detail-content-score" > 
            vs
          </view>
          <view 
            wx:else
            disabled="{{vsBtnDisable}}" 
            data-id="{{item._id}}" 
            data-index="{{index}}" 
            bindtap="onClickNone"
            bindlongpress="onLongPressScore"
            class="detail-content-score" > 
            {{item.score1}}:{{item.score2}}
          </view>
        </view>
        
        <!-- column3 -->
        <view class="detail-content-column">
          <view class="detail-content-avatars">
            <image 
              class="avatar" 
              src="{{item.playerInfo3.avatarUrl}}" >
              </image>
            <image class="avatar" 
              src="{{item.playerInfo4.avatarUrl}}" >
              </image> 
          </view>
          <view class="detail-content-names">
            <view class="detail-content-name">
              {{item.playerInfo3.name}}
            </view>
            <view class="detail-content-name">
              {{item.playerInfo4.name}}
            </view>        
          </view>
        </view>

      </view>
      <!-- end of detail-content -->
        
    </view>

  </view>

  <!-- stats -->
  <view class="tab-page" wx:if="{{tabIndex==1}}" >

    <image class="banner" src="../../images/banner.jpg" mode="aspectFill" ></image>

    <view class="stats-container" >

      <!-- header -->
      <view 
        style="display: flex; direction: row;align-items: center; padding-left: 0rpx; margin-top: 20rpx;" >

        <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >排名</label >

        <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >姓名</label >

        <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >胜场数</label>

        <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >负场数</label>

        <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >净胜球</label>
        
        <label style="border: none; flex: 1; text-align: center; font-size-adjust: 0.5; " >总得分</label>

      </view>

      <view 
        wx:for="{{matchPlayers}}"
        wx:key="{item._id}"
        wx:for-index="index" 
        class="uploader"
        style="flex-direction: row;align-items: center; padding-left: 0rpx; margin-top: 20rpx;" >

        <label 
          wx:if="{{(!matchDone || (index!=0 && (index!=matchPlayers.length-1)))}}" 
          style="border: none; flex: 1; text-align: center;" > 
          {{index+1}}
        </label >

        <image wx:if="{{(matchDone && (index==0))}}" 
          src="../../images/crown.png" mode="aspectFit"
          style="height: 50rpx; width: 50rpx; flex: 1;" >
        </image>

        <image wx:if="{{(matchDone && (index==matchPlayers.length-1))}}" 
          src="../../images/pighead.png" mode="aspectFit"
          style="height: 50rpx; width: 50rpx; flex: 1;" >
        </image>

        <!-- "{{item.avatarUrl}}"  -->
        <image class="avatar" 
          src="../../images/user-unlogin.png" >
          </image>

        <label style="border: none; flex: 1; text-align: center; font-size: 32rpx;" > 
          {{item.name}}
        </label >

        <label style="border: none; flex: 1; text-align: center;" > 
          {{item.win}}
        </label>

        <label style="border: none; flex: 1; text-align: center;" > 
          {{item.lost}}
        </label>

        <label style="border: none; flex: 1; text-align: center;" > 
          {{item.delta}}
        </label>
        
        <label style="border: none; flex: 1; text-align: center;" > 
          {{item.total}}
        </label>

      </view>
    </view>

  </view>
  <!-- end of  stats -->

</view>

<mp-tabbar 
  wx:if="{{saved}}"
  style="position:fixed;bottom:0;width:100%;left:0;right:0;" 
  list="{{list}}"  bindchange="tabChange" >
  </mp-tabbar>

<mp-dialog 
  title="比分" 
  show="{{dialogShow}}" 
  bindbuttontap="tapDialogButton" 
  buttons="{{dialogBtns}}">

  <view style="display: flex; flex-direction: column;">  
    <view style="display: flex; flex-direction: row; margin-bottom: 20px; justify-content: center;">  
      <input 
        style="background-color: #EEE; width: 30%; flex: 3; height: 30px; font-size: 20px; padding-top: 5px; " type="number" value="{{(tempScore1<0?'':tempScore1)}}" 
        bindchange="inputScore1" focus="true" ></input>
      <text style="flex: 1; padding-top: 5px; ">:</text>
      <input 
        style="background-color: #EEE; width: 30%; flex: 3; height: 30px; font-size: 20px; padding-top: 5px; " type="number" value="{{(tempScore2<0?'':tempScore2)}}" 
        bindchange="inputScore2" ></input>
    </view>    
    <view style="display: flex; flex-direction: row; justify-content: center;">  
      <view style="flex: 4" >
        <text>{{games[clickIndex].playerName1}} {{games[clickIndex].playerName2}}</text>
      </view>
      <text style="flex: 1" >/</text>
      <view style="flex: 4" >
        <text>{{games[clickIndex].playerName3}} {{games[clickIndex].playerName4}}</text>
      </view>
    </view>
  </view>
</mp-dialog>