<!--miniprogram/pages/matches/detail.wxml-->

<mp-navigation-bar loading="{{loading}}" show="{{true}}" animated="{{animated}}" color="{{/*'red'*/}}" background="{{'white'}}" title="{{title}}" back="{{true}}"></mp-navigation-bar>

<button 
	wx:if="{{action=='new'}}" 
	class="weui-btn" 
  type="primary" size="mini"
  style="margin-top: 20rpx" 
  bindtap="onSaveMatch">
	保存
</button>

<view style="margin-bottom:70px" >

  <!-- games -->
  <view wx:if="{{tabIndex==0}}" >

    <view 
      wx:for="{{games}}"
      wx:key="{item._id}"
      wx:for-index="index" 
      class="detail-block"
      style="background-color: {{(item.score1>=0 && item.score2>=0)? '#DDFFDD' : 'white' }};" >

      <view class="detail-title">
        <image wx:if="{{(item.score1>=0 && item.score2>=0)}}"
          class="detail-title-icon" 
          src="../../images/done.svg" >
          </image>
        <image wx:else class="detail-title-icon" 
          src="../../images/clock.svg" >
          </image>
        <view class="detail-title-text" >第{{index+1}}场</view>
      </view> 

      <!-- detail-content -->
      <view class="detail-content">
        
        <!-- <label 
          style="border: none; flex: 1; text-align: center;" > 
          {{(index+1)}}
        </label> -->

        <!-- column1 -->
        <view class="detail-content-column">
          <view class="detail-content-avatars">
            <image 
              class="avatar" 
              src="{{item.playerInfo1.avatarUrl}}" >
              </image>
            <image class="avatar" 
              src="{{item.playerInfo2.avatarUrl}}" >
              </image> 
          </view>
          <view class="detail-content-names">
            <view class="detail-content-name">
              {{item.playerInfo1.name}}
            </view>
            <view class="detail-content-name">
              {{item.playerInfo2.name}}
            </view>        
          </view>
        </view>

        <!-- column2 -->
        <view class="detail-content-column">
          <view 
            wx:if="{{(item.score1<0 || item.score2<0)}}"
            data-id="{{item._id}}" 
            data-index="{{index}}" 
            bindtap="onClickScore"
            class="{{ vsBtnDisable ? 'disabled' : 'detail-content-score' }}"> 
            vs
          </view>
          <view 
            wx:else
            data-id="{{item._id}}" 
            data-index="{{index}}" 
            bindtap="onClickNone"
            bindlongpress="onLongPressScore"
            class="detail-content-score" > 
            {{item.score1}}:{{item.score2}}
          </view>
        </view>
        
        <!-- column3 -->
        <view class="detail-content-column">
          <view class="detail-content-avatars">
            <image 
              class="avatar" 
              src="{{item.playerInfo3.avatarUrl}}" >
              </image>
            <image class="avatar" 
              src="{{item.playerInfo4.avatarUrl}}" >
              </image> 
          </view>
          <view class="detail-content-names">
            <view class="detail-content-name">
              {{item.playerInfo3.name}}
            </view>
            <view class="detail-content-name">
              {{item.playerInfo4.name}}
            </view>        
          </view>
        </view>

      </view>
      <!-- end of detail-content -->
        
    </view>

  </view>

  <!-- stats -->
  <view class="tab-page" wx:if="{{tabIndex==1}}" >

    <image class="banner" src="../../images/banner.jpg" mode="aspectFill" ></image>

    <view class="stats-container" >

      <!-- header -->
      <view class="statistic-header-container" >
        <view class="statistic-header-label">排名</view >
        <label class="statistic-header-label">姓名</label >
        <label class="statistic-header-label">胜场数</label>
        <label class="statistic-header-label">负场数</label>
        <label class="statistic-header-label">净胜球</label>
        <label class="statistic-header-label">总得分</label>
      </view>

      <view 
        wx:for="{{matchPlayers}}"
        wx:key="{item._id}"
        wx:for-index="index" 
        class="statistic-line">

        <image wx:if="{{(matchDone && (index==0))}}" 
          src="../../images/crown.png" mode="aspectFit"
          class="statistic-icon">
          </image>
        <image wx:elif="{{(matchDone && (index==matchPlayers.length-1))}}" 
          src="../../images/pighead.png" mode="aspectFit"
          class="statistic-icon">
          </image>
        <view wx:else
          class="statistic-line-column" >{{index+1}}</view>

        <image class="avatar" 
          src="{{item.avatarUrl}}">
          </image>

        <view class="statistic-line-column" >{{item.name}}</view>
        <view class="statistic-line-column" >{{item.win}}</view>
        <view class="statistic-line-column" >{{item.lost}}</view>
        <view class="statistic-line-column" >{{item.delta}}</view>
        <view class="statistic-line-column" >{{item.total}}</view>

      </view>
    </view>

  </view>
  <!-- end of  stats -->

</view>

<mp-tabbar 
  wx:if="{{saved}}"
  style="position:fixed;bottom:0;width:100%;left:0;right:0;" 
  list="{{tabLabelList}}"  bindchange="tabChange" >
  </mp-tabbar>

<mp-dialog 
  title="比分" 
  show="{{dialogShow}}" 
  bindbuttontap="tapDialogButton" 
  buttons="{{dialogBtns}}">

  <view style="display: flex; flex-direction: column;">  
    <view style="display: flex; flex-direction: row; margin-bottom: 20px; justify-content: center;">  
      <input 
        style="background-color: #EEE; width: 30%; flex: 3; height: 30px; font-size: 20px; padding-top: 5px; " type="number" value="{{(tempScore1<0?'':tempScore1)}}" 
        bindchange="inputScore1" focus="true" ></input>
      <text style="flex: 1; padding-top: 5px; ">:</text>
      <input 
        style="background-color: #EEE; width: 30%; flex: 3; height: 30px; font-size: 20px; padding-top: 5px; " type="number" value="{{(tempScore2<0?'':tempScore2)}}" 
        bindchange="inputScore2" ></input>
    </view>    
    <view style="display: flex; flex-direction: row; justify-content: center;">  
      <view style="flex: 4" >
        <text>{{games[clickIndex].playerInfo1.name}} {{games[clickIndex].playerInfo2.name}}</text>
      </view>
      <text style="flex: 1" >/</text>
      <view style="flex: 4" >
        <text>{{games[clickIndex].playerInfo3.name}} {{games[clickIndex].playerInfo4.name}}</text>
      </view>
    </view>
  </view>
</mp-dialog>