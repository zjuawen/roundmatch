{"version":3,"sources":["index.js","dist/index.js","dist/Config.js","dist/utils/index.js","dist/utils/constants.js","dist/Kernel.js","dist/Plugin.js","dist/platform-plugin-base/index.js","dist/platform-plugin-base/mini.js","dist/utils/package.js","dist/platform-plugin-base/platform.js","dist/platform-plugin-base/web.js","dist/utils/types.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AENA;ADIA,ADGA,AGTA,ADGA;ADIA,ADGA,AGTA,ADGA;ADIA,ADGA,AGTA,ADGA;ADIA,AGTA,AJYA,AGTA,ADGA;ADIA,AGTA,AJYA,AGTA,ADGA;ADIA,AGTA,AJYA,AGTA,ADGA;ADIA,AGTA,ACHA,ALeA,AGTA,ADGA;ADIA,AGTA,ACHA,ALeA,AGTA,ADGA;ADIA,AGTA,ACHA,ALeA,AGTA,ADGA;ADIA,AGTA,ACHA,ALeA,AMlBA,AHSA,ADGA;ADIA,AGTA,ACHA,ALeA,AMlBA,AHSA,ADGA;ADIA,AGTA,ACHA,ALeA,AMlBA,AHSA,ADGA;ADIA,AGTA,ACHA,ALeA,AMlBA,ACHA,AJYA,ADGA;ADIA,AGTA,ACHA,ALeA,AMlBA,ACHA,AJYA,ADGA;ADIA,AGTA,ACHA,ALeA,AMlBA,ACHA,AJYA,ADGA;ADIA,AGTA,ACHA,ALeA,AMlBA,ACHA,AJYA,ADGA,AMlBA;APsBA,AGTA,ACHA,ALeA,AMlBA,ACHA,AJYA,ADGA,AMlBA;APsBA,AGTA,ACHA,ALeA,AMlBA,ACHA,AJYA,ADGA,AMlBA;APsBA,AGTA,ACHA,ACHA,ACHA,AENA,ANkBA,ADGA,AMlBA;APsBA,AGTA,ACHA,ACHA,ACHA,AENA,ANkBA,ADGA,AMlBA;APsBA,AGTA,ACHA,ACHA,ACHA,AENA,ANkBA,ADGA,AMlBA;APsBA,AGTA,ACHA,ACHA,ACHA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,ACHA,ACHA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,ACHA,ACHA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,ACHA,ACHA,AENA,ACHA,ARwBA,AMlBA,AGTA;AV+BA,AGTA,ACHA,ACHA,ACHA,AENA,ACHA,ARwBA,AMlBA,AGTA;AV+BA,AGTA,ACHA,ACHA,ACHA,AENA,ACHA,ARwBA,AMlBA,AGTA;AV+BA,AGTA,ACHA,ACHA,ACHA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA,AMlBA;APsBA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;ADIA,AGTA,ACHA,AENA,AENA,ACHA,ARwBA;AELA,AGTA,AENA,ACHA,ARwBA;AELA,AGTA,AENA,ACHA,ARwBA;AELA,AGTA,AENA,ACHA,ARwBA;AELA,AGTA,AENA,ACHA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA,ARwBA;AELA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA,AGTA;ANmBA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA,AGTA;AHUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["module.exports = require('./dist/index.js').default\n\nmodule.exports.default = module.exports\n","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TaroPlatformWeb = exports.TaroPlatformBase = exports.Kernel = exports.Config = void 0;\nconst Config_1 = require(\"./Config\");\nexports.Config = Config_1.default;\nconst Kernel_1 = require(\"./Kernel\");\nexports.Kernel = Kernel_1.default;\nconst platform_plugin_base_1 = require(\"./platform-plugin-base\");\nObject.defineProperty(exports, \"TaroPlatformBase\", { enumerable: true, get: function () { return platform_plugin_base_1.TaroPlatformBase; } });\nObject.defineProperty(exports, \"TaroPlatformWeb\", { enumerable: true, get: function () { return platform_plugin_base_1.TaroPlatformWeb; } });\n__exportStar(require(\"./utils/types\"), exports);\nexports.default = { Config: Config_1.default, Kernel: Kernel_1.default, TaroPlatformBase: platform_plugin_base_1.TaroPlatformBase, TaroPlatformWeb: platform_plugin_base_1.TaroPlatformWeb };\n//# sourceMappingURL=index.js.map","\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst helper_1 = require(\"@tarojs/helper\");\nconst ora = require(\"ora\");\nconst path = require(\"path\");\nconst merge = require(\"webpack-merge\");\nconst utils_1 = require(\"./utils\");\nconst constants_1 = require(\"./utils/constants\");\nclass Config {\n    constructor(opts) {\n        this.appPath = opts.appPath;\n        this.disableGlobalConfig = !!(opts === null || opts === void 0 ? void 0 : opts.disableGlobalConfig);\n    }\n    init(configEnv) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.initialConfig = {};\n            this.initialGlobalConfig = {};\n            this.isInitSuccess = false;\n            this.configPath = (0, helper_1.resolveScriptPath)(path.join(this.appPath, constants_1.CONFIG_DIR_NAME, constants_1.DEFAULT_CONFIG_FILE));\n            if (!helper_1.fs.existsSync(this.configPath)) {\n                if (this.disableGlobalConfig)\n                    return;\n                this.initGlobalConfig();\n            }\n            else {\n                this.initGlobalConfig(configEnv.command);\n                (0, helper_1.createSwcRegister)({\n                    only: [\n                        filePath => filePath.indexOf(path.join(this.appPath, constants_1.CONFIG_DIR_NAME)) >= 0\n                    ]\n                });\n                try {\n                    const userExport = (0, helper_1.getModuleDefaultExport)(require(this.configPath));\n                    this.initialConfig = typeof userExport === 'function' ? yield userExport(merge, configEnv) : userExport;\n                    this.isInitSuccess = true;\n                }\n                catch (err) {\n                    console.log(err);\n                }\n            }\n        });\n    }\n    initGlobalConfig(command = '') {\n        const homedir = (0, helper_1.getUserHomeDir)();\n        if (!homedir)\n            return console.error('Ëé∑Âèñ‰∏çÂà∞Áî®Êà∑ home Ë∑ØÂæÑ');\n        const globalPluginConfigPath = path.join((0, helper_1.getUserHomeDir)(), helper_1.TARO_GLOBAL_CONFIG_DIR, helper_1.TARO_GLOBAL_CONFIG_FILE);\n        const spinner = ora(`ÂºÄÂßãËé∑Âèñ taro ÂÖ®Â±ÄÈÖçÁΩÆÊñá‰ª∂Ôºö ${globalPluginConfigPath}`).start();\n        if (!helper_1.fs.existsSync(globalPluginConfigPath))\n            return spinner.warn(`Ëé∑Âèñ taro ÂÖ®Â±ÄÈÖçÁΩÆÊñá‰ª∂Â§±Ë¥•Ôºå‰∏çÂ≠òÂú®ÂÖ®Â±ÄÈÖçÁΩÆÊñá‰ª∂Ôºö${globalPluginConfigPath}`);\n        try {\n            this.initialGlobalConfig = helper_1.fs.readJSONSync(globalPluginConfigPath) || {};\n            this.initialGlobalConfig = (0, utils_1.filterGlobalConfig)(this.initialGlobalConfig, command);\n            spinner.succeed('Ëé∑Âèñ taro ÂÖ®Â±ÄÈÖçÁΩÆÊàêÂäü');\n        }\n        catch (e) {\n            spinner.stop();\n            console.warn(`Ëé∑ÂèñÂÖ®Â±ÄÈÖçÁΩÆÂ§±Ë¥•ÔºåÂ¶ÇÊûúÈúÄË¶ÅÂêØÁî®ÂÖ®Â±ÄÊèí‰ª∂ËØ∑Êü•ÁúãÈÖçÁΩÆÊñá‰ª∂: ${globalPluginConfigPath} `);\n        }\n    }\n    getConfigWithNamed(platform, configName) {\n        const initialConfig = this.initialConfig;\n        const sourceDirName = initialConfig.sourceRoot || helper_1.SOURCE_DIR;\n        const outputDirName = initialConfig.outputRoot || helper_1.OUTPUT_DIR;\n        const sourceDir = path.join(this.appPath, sourceDirName);\n        const entryName = helper_1.ENTRY;\n        const entryFilePath = (0, helper_1.resolveScriptPath)(path.join(sourceDir, entryName));\n        const entry = {\n            [entryName]: [entryFilePath]\n        };\n        return Object.assign(Object.assign({ entry, alias: initialConfig.alias || {}, copy: initialConfig.copy, sourceRoot: sourceDirName, outputRoot: outputDirName, platform, framework: initialConfig.framework, compiler: initialConfig.compiler, cache: initialConfig.cache, logger: initialConfig.logger, baseLevel: initialConfig.baseLevel, csso: initialConfig.csso, sass: initialConfig.sass, uglify: initialConfig.uglify, plugins: initialConfig.plugins, projectName: initialConfig.projectName, env: initialConfig.env, defineConstants: initialConfig.defineConstants, designWidth: initialConfig.designWidth, deviceRatio: initialConfig.deviceRatio, projectConfigName: initialConfig.projectConfigName, jsMinimizer: initialConfig.jsMinimizer, cssMinimizer: initialConfig.cssMinimizer, terser: initialConfig.terser, esbuild: initialConfig.esbuild }, initialConfig[configName]), initialConfig[platform]);\n    }\n}\nexports.default = Config;\n//# sourceMappingURL=Config.js.map","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.filterGlobalConfig = exports.printHelpLog = exports.resolvePresetsOrPlugins = exports.mergePlugins = exports.convertPluginsToObject = exports.getPluginPath = exports.isNpmPkg = void 0;\nconst helper_1 = require(\"@tarojs/helper\");\nconst lodash_1 = require(\"lodash\");\nconst path = require(\"path\");\nconst resolve = require(\"resolve\");\nconst isNpmPkg = name => !(/^(\\.|\\/)/.test(name));\nexports.isNpmPkg = isNpmPkg;\nfunction getPluginPath(pluginPath) {\n    if ((0, exports.isNpmPkg)(pluginPath) || path.isAbsolute(pluginPath))\n        return pluginPath;\n    throw new Error('plugin Âíå preset ÈÖçÁΩÆÂøÖÈ°ª‰∏∫ÁªùÂØπË∑ØÂæÑÊàñËÄÖÂåÖÂêç');\n}\nexports.getPluginPath = getPluginPath;\nfunction convertPluginsToObject(items) {\n    return () => {\n        const obj = {};\n        if (Array.isArray(items)) {\n            items.forEach(item => {\n                if (typeof item === 'string') {\n                    const name = getPluginPath(item);\n                    obj[name] = null;\n                }\n                else if (Array.isArray(item)) {\n                    const name = getPluginPath(item[0]);\n                    obj[name] = item[1];\n                }\n            });\n        }\n        return obj;\n    };\n}\nexports.convertPluginsToObject = convertPluginsToObject;\nfunction mergePlugins(dist, src) {\n    return () => {\n        const srcObj = convertPluginsToObject(src)();\n        const distObj = convertPluginsToObject(dist)();\n        return (0, lodash_1.merge)(distObj, srcObj);\n    };\n}\nexports.mergePlugins = mergePlugins;\n// getModuleDefaultExport\nfunction resolvePresetsOrPlugins(root, args, type, skipError) {\n    var _a, _b;\n    // ÂÖ®Â±ÄÁöÑÊèí‰ª∂ÂºïÂÖ•Êä•ÈîôÔºå‰∏çÊäõÂá∫ Error ÂΩ±Âìç‰∏ªÊµÅÁ®ãÔºåËÄåÊòØÈÄöËøá log ÊèêÈÜíÁÑ∂ÂêéÊääÊèí‰ª∂ filter ÊéâÔºå‰øùËØÅ‰∏ªÊµÅÁ®ã‰∏çÂèò\n    const resolvedPresetsOrPlugins = [];\n    const presetsOrPluginsNames = Object.keys(args) || [];\n    for (let i = 0; i < presetsOrPluginsNames.length; i++) {\n        const item = presetsOrPluginsNames[i];\n        let fPath;\n        try {\n            fPath = resolve.sync(item, {\n                basedir: root,\n                extensions: ['.js', '.ts']\n            });\n        }\n        catch (err) {\n            if ((_a = args[item]) === null || _a === void 0 ? void 0 : _a.backup) {\n                // Â¶ÇÊûúÈ°πÁõÆ‰∏≠Ê≤°ÊúâÔºåÂèØ‰ª•‰ΩøÁî® CLI ‰∏≠ÁöÑÊèí‰ª∂\n                fPath = (_b = args[item]) === null || _b === void 0 ? void 0 : _b.backup;\n            }\n            else if (skipError) {\n                // Â¶ÇÊûúË∑≥ËøáÊä•ÈîôÔºåÈÇ£‰πà log ÊèêÈÜíÔºåÂπ∂‰∏î‰∏ç‰ΩøÁî®ËØ•Êèí‰ª∂\n                console.log(helper_1.chalk.yellow(`Êâæ‰∏çÂà∞Êèí‰ª∂‰æùËµñ \"${item}\"ÔºåËØ∑ÂÖàÂú®È°πÁõÆ‰∏≠ÂÆâË£ÖÔºåÈ°πÁõÆË∑ØÂæÑÔºö${root}`));\n                continue;\n            }\n            else {\n                console.log(helper_1.chalk.red(`Êâæ‰∏çÂà∞Êèí‰ª∂‰æùËµñ \"${item}\"ÔºåËØ∑ÂÖàÂú®È°πÁõÆ‰∏≠ÂÆâË£ÖÔºåÈ°πÁõÆË∑ØÂæÑÔºö${root}`));\n                process.exit(1);\n            }\n        }\n        const resolvedItem = {\n            id: fPath,\n            path: fPath,\n            type,\n            opts: args[item] || {},\n            apply() {\n                try {\n                    return (0, helper_1.getModuleDefaultExport)(require(fPath));\n                }\n                catch (error) {\n                    console.error(error);\n                    // ÂÖ®Â±ÄÁöÑÊèí‰ª∂ËøêË°åÊä•ÈîôÔºå‰∏çÊäõÂá∫ Error ÂΩ±Âìç‰∏ªÊµÅÁ®ãÔºåËÄåÊòØÈÄöËøá log ÊèêÈÜíÁÑ∂ÂêéÊääÊèí‰ª∂ filter ÊéâÔºå‰øùËØÅ‰∏ªÊµÅÁ®ã‰∏çÂèò\n                    if (skipError) {\n                        console.error(`Êèí‰ª∂‰æùËµñ \"${item}\" Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êèí‰ª∂ÈÖçÁΩÆ`);\n                    }\n                    else {\n                        throw new Error(`Êèí‰ª∂‰æùËµñ \"${item}\" Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êèí‰ª∂ÈÖçÁΩÆ`);\n                    }\n                }\n            }\n        };\n        resolvedPresetsOrPlugins.push(resolvedItem);\n    }\n    return resolvedPresetsOrPlugins;\n}\nexports.resolvePresetsOrPlugins = resolvePresetsOrPlugins;\nfunction supplementBlank(length) {\n    return Array(length).map(() => '').join(' ');\n}\nfunction printHelpLog(command, optionsList, synopsisList) {\n    console.log(`Usage: taro ${command} [options]`);\n    console.log();\n    console.log('Options:');\n    const keys = Array.from(optionsList.keys());\n    const maxLength = keys.reduce((v1, v2) => {\n        return v1.length > v2.length ? v1 : v2;\n    }).length + 3;\n    optionsList.forEach((v, k) => {\n        const supplementBlankLength = maxLength - k.length;\n        console.log(`  ${k}${supplementBlank(supplementBlankLength)}${v}`);\n    });\n    if (synopsisList && synopsisList.size) {\n        console.log();\n        console.log('Synopsis:');\n        synopsisList.forEach(item => {\n            console.log(`  $ ${item}`);\n        });\n    }\n}\nexports.printHelpLog = printHelpLog;\nfunction filterGlobalConfig(globalConfig, command) {\n    var _a;\n    if (!command) {\n        return globalConfig;\n    }\n    const config = globalConfig;\n    const RelatedPluginTag = `@jdtaro/plugin-${command}-`;\n    if ((_a = config.plugins) === null || _a === void 0 ? void 0 : _a.length) {\n        config.plugins = config.plugins.filter(pluginName => {\n            return pluginName.includes(RelatedPluginTag);\n        });\n    }\n    return config;\n}\nexports.filterGlobalConfig = filterGlobalConfig;\n//# sourceMappingURL=index.js.map","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PluginNamePrefix = exports.PluginType = exports.presetOrPluginPrefixReg = exports.IS_MODIFY_HOOK = exports.IS_ADD_HOOK = exports.IS_EVENT_HOOK = exports.PLUGIN_PREFIX = exports.PRESET_PREFIX = exports.DEFAULT_CONFIG_FILE = exports.CONFIG_DIR_NAME = void 0;\nexports.CONFIG_DIR_NAME = 'config';\nexports.DEFAULT_CONFIG_FILE = 'index';\nexports.PRESET_PREFIX = '@tarojs/preset-';\nexports.PLUGIN_PREFIX = '@tarojs/plugin-';\nexports.IS_EVENT_HOOK = /^on/;\nexports.IS_ADD_HOOK = /^add/;\nexports.IS_MODIFY_HOOK = /^modify/;\nexports.presetOrPluginPrefixReg = new RegExp(`^${exports.PRESET_PREFIX}|${exports.PLUGIN_PREFIX}`);\nvar PluginType;\n(function (PluginType) {\n    PluginType[\"Preset\"] = \"Preset\";\n    PluginType[\"Plugin\"] = \"Plugin\";\n})(PluginType = exports.PluginType || (exports.PluginType = {}));\nexports.PluginNamePrefix = {\n    [PluginType.Preset]: exports.PLUGIN_PREFIX,\n    [PluginType.Plugin]: exports.PLUGIN_PREFIX\n};\n//# sourceMappingURL=constants.js.map","\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst helper = require(\"@tarojs/helper\");\nconst shared_1 = require(\"@tarojs/shared\");\nconst events_1 = require(\"events\");\nconst lodash_1 = require(\"lodash\");\nconst path = require(\"path\");\nconst tapable_1 = require(\"tapable\");\nconst Plugin_1 = require(\"./Plugin\");\nconst utils_1 = require(\"./utils\");\nconst constants_1 = require(\"./utils/constants\");\nclass Kernel extends events_1.EventEmitter {\n    constructor(options) {\n        super();\n        this.debugger = process.env.DEBUG === 'Taro:Kernel' ? helper.createDebug('Taro:Kernel') : function () { };\n        this.appPath = options.appPath || process.cwd();\n        this.optsPresets = options.presets;\n        this.optsPlugins = options.plugins;\n        this.config = options.config;\n        this.hooks = new Map();\n        this.methods = new Map();\n        this.commands = new Map();\n        this.platforms = new Map();\n        this.initHelper();\n        this.initConfig();\n        this.initPaths();\n    }\n    initConfig() {\n        this.initialConfig = this.config.initialConfig;\n        this.initialGlobalConfig = this.config.initialGlobalConfig;\n        this.debugger('initConfig', this.initialConfig);\n    }\n    initPaths() {\n        this.paths = {\n            appPath: this.appPath,\n            nodeModulesPath: helper.recursiveFindNodeModules(path.join(this.appPath, helper.NODE_MODULES))\n        };\n        if (this.config.isInitSuccess) {\n            Object.assign(this.paths, {\n                configPath: this.config.configPath,\n                sourcePath: path.join(this.appPath, this.initialConfig.sourceRoot),\n                outputPath: path.resolve(this.appPath, this.initialConfig.outputRoot)\n            });\n        }\n        this.debugger(`initPaths:${JSON.stringify(this.paths, null, 2)}`);\n    }\n    initHelper() {\n        this.helper = helper;\n        this.debugger('initHelper');\n    }\n    initPresetsAndPlugins() {\n        const initialConfig = this.initialConfig;\n        const initialGlobalConfig = this.initialGlobalConfig;\n        const cliAndProjectConfigPresets = (0, utils_1.mergePlugins)(this.optsPresets || [], initialConfig.presets || [])();\n        const cliAndProjectPlugins = (0, utils_1.mergePlugins)(this.optsPlugins || [], initialConfig.plugins || [])();\n        const globalPlugins = (0, utils_1.convertPluginsToObject)(initialGlobalConfig.plugins || [])();\n        const globalPresets = (0, utils_1.convertPluginsToObject)(initialGlobalConfig.presets || [])();\n        this.debugger('initPresetsAndPlugins', cliAndProjectConfigPresets, cliAndProjectPlugins);\n        this.debugger('globalPresetsAndPlugins', globalPlugins, globalPresets);\n        process.env.NODE_ENV !== 'test' &&\n            helper.createSwcRegister({\n                only: [\n                    ...Object.keys(cliAndProjectConfigPresets),\n                    ...Object.keys(cliAndProjectPlugins),\n                    ...Object.keys(globalPresets),\n                    ...Object.keys(globalPlugins)\n                ]\n            });\n        this.plugins = new Map();\n        this.extraPlugins = {};\n        this.globalExtraPlugins = {};\n        this.resolvePresets(cliAndProjectConfigPresets, globalPresets);\n        this.resolvePlugins(cliAndProjectPlugins, globalPlugins);\n    }\n    resolvePresets(cliAndProjectPresets, globalPresets) {\n        const resolvedCliAndProjectPresets = (0, utils_1.resolvePresetsOrPlugins)(this.appPath, cliAndProjectPresets, constants_1.PluginType.Preset);\n        while (resolvedCliAndProjectPresets.length) {\n            this.initPreset(resolvedCliAndProjectPresets.shift());\n        }\n        const globalConfigRootPath = path.join(helper.getUserHomeDir(), helper.TARO_GLOBAL_CONFIG_DIR);\n        const resolvedGlobalPresets = (0, utils_1.resolvePresetsOrPlugins)(globalConfigRootPath, globalPresets, constants_1.PluginType.Plugin, true);\n        while (resolvedGlobalPresets.length) {\n            this.initPreset(resolvedGlobalPresets.shift(), true);\n        }\n    }\n    resolvePlugins(cliAndProjectPlugins, globalPlugins) {\n        cliAndProjectPlugins = (0, lodash_1.merge)(this.extraPlugins, cliAndProjectPlugins);\n        const resolvedCliAndProjectPlugins = (0, utils_1.resolvePresetsOrPlugins)(this.appPath, cliAndProjectPlugins, constants_1.PluginType.Plugin);\n        globalPlugins = (0, lodash_1.merge)(this.globalExtraPlugins, globalPlugins);\n        const globalConfigRootPath = path.join(helper.getUserHomeDir(), helper.TARO_GLOBAL_CONFIG_DIR);\n        const resolvedGlobalPlugins = (0, utils_1.resolvePresetsOrPlugins)(globalConfigRootPath, globalPlugins, constants_1.PluginType.Plugin, true);\n        const resolvedPlugins = resolvedCliAndProjectPlugins.concat(resolvedGlobalPlugins);\n        while (resolvedPlugins.length) {\n            this.initPlugin(resolvedPlugins.shift());\n        }\n        this.extraPlugins = {};\n        this.globalExtraPlugins = {};\n    }\n    initPreset(preset, isGlobalConfigPreset) {\n        this.debugger('initPreset', preset);\n        const { id, path, opts, apply } = preset;\n        const pluginCtx = this.initPluginCtx({ id, path, ctx: this });\n        const { presets, plugins } = apply()(pluginCtx, opts) || {};\n        this.registerPlugin(preset);\n        if (Array.isArray(presets)) {\n            const _presets = (0, utils_1.resolvePresetsOrPlugins)(this.appPath, (0, utils_1.convertPluginsToObject)(presets)(), constants_1.PluginType.Preset, isGlobalConfigPreset);\n            while (_presets.length) {\n                this.initPreset(_presets.shift(), isGlobalConfigPreset);\n            }\n        }\n        if (Array.isArray(plugins)) {\n            isGlobalConfigPreset\n                ? (this.globalExtraPlugins = (0, lodash_1.merge)(this.globalExtraPlugins, (0, utils_1.convertPluginsToObject)(plugins)()))\n                : (this.extraPlugins = (0, lodash_1.merge)(this.extraPlugins, (0, utils_1.convertPluginsToObject)(plugins)()));\n        }\n    }\n    initPlugin(plugin) {\n        const { id, path, opts, apply } = plugin;\n        const pluginCtx = this.initPluginCtx({ id, path, ctx: this });\n        this.debugger('initPlugin', plugin);\n        this.registerPlugin(plugin);\n        apply()(pluginCtx, opts);\n        this.checkPluginOpts(pluginCtx, opts);\n    }\n    applyCliCommandPlugin(commandNames = []) {\n        const existsCliCommand = [];\n        for (let i = 0; i < commandNames.length; i++) {\n            const commandName = commandNames[i];\n            const commandFilePath = path.resolve(this.cliCommandsPath, `${commandName}.js`);\n            if (this.cliCommands.includes(commandName))\n                existsCliCommand.push(commandFilePath);\n        }\n        const commandPlugins = (0, utils_1.convertPluginsToObject)(existsCliCommand || [])();\n        helper.createSwcRegister({ only: [...Object.keys(commandPlugins)] });\n        const resolvedCommandPlugins = (0, utils_1.resolvePresetsOrPlugins)(this.appPath, commandPlugins, constants_1.PluginType.Plugin);\n        while (resolvedCommandPlugins.length) {\n            this.initPlugin(resolvedCommandPlugins.shift());\n        }\n    }\n    checkPluginOpts(pluginCtx, opts) {\n        if (typeof pluginCtx.optsSchema !== 'function') {\n            return;\n        }\n        this.debugger('checkPluginOpts', pluginCtx);\n        const joi = require('joi');\n        const schema = pluginCtx.optsSchema(joi);\n        if (!joi.isSchema(schema)) {\n            throw new Error(`Êèí‰ª∂${pluginCtx.id}‰∏≠ËÆæÁΩÆÂèÇÊï∞Ê£ÄÊü• schema ÊúâËØØÔºåËØ∑Ê£ÄÊü•ÔºÅ`);\n        }\n        const { error } = schema.validate(opts);\n        if (error) {\n            error.message = `Êèí‰ª∂${pluginCtx.id}Ëé∑ÂæóÁöÑÂèÇÊï∞‰∏çÁ¨¶ÂêàË¶ÅÊ±ÇÔºåËØ∑Ê£ÄÊü•ÔºÅ`;\n            throw error;\n        }\n    }\n    registerPlugin(plugin) {\n        this.debugger('registerPlugin', plugin);\n        if (this.plugins.has(plugin.id)) {\n            throw new Error(`Êèí‰ª∂ ${plugin.id} Â∑≤Ë¢´Ê≥®ÂÜå`);\n        }\n        this.plugins.set(plugin.id, plugin);\n    }\n    initPluginCtx({ id, path, ctx }) {\n        const pluginCtx = new Plugin_1.default({ id, path, ctx });\n        const internalMethods = ['onReady', 'onStart'];\n        const kernelApis = [\n            'appPath',\n            'plugins',\n            'platforms',\n            'paths',\n            'helper',\n            'runOpts',\n            'initialConfig',\n            'applyPlugins',\n            'applyCliCommandPlugin'\n        ];\n        internalMethods.forEach(name => {\n            if (!this.methods.has(name)) {\n                pluginCtx.registerMethod(name);\n            }\n        });\n        return new Proxy(pluginCtx, {\n            get: (target, name) => {\n                if (this.methods.has(name)) {\n                    const method = this.methods.get(name);\n                    if (Array.isArray(method)) {\n                        return (...arg) => {\n                            method.forEach(item => {\n                                item.apply(this, arg);\n                            });\n                        };\n                    }\n                    return method;\n                }\n                if (kernelApis.includes(name)) {\n                    return typeof this[name] === 'function' ? this[name].bind(this) : this[name];\n                }\n                return target[name];\n            }\n        });\n    }\n    applyPlugins(args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let name;\n            let initialVal;\n            let opts;\n            if (typeof args === 'string') {\n                name = args;\n            }\n            else {\n                name = args.name;\n                initialVal = args.initialVal;\n                opts = args.opts;\n            }\n            this.debugger('applyPlugins');\n            this.debugger(`applyPlugins:name:${name}`);\n            this.debugger(`applyPlugins:initialVal:${initialVal}`);\n            this.debugger(`applyPlugins:opts:${opts}`);\n            if (typeof name !== 'string') {\n                throw new Error('Ë∞ÉÁî®Â§±Ë¥•ÔºåÊú™‰º†ÂÖ•Ê≠£Á°ÆÁöÑÂêçÁß∞ÔºÅ');\n            }\n            const hooks = this.hooks.get(name) || [];\n            if (!hooks.length) {\n                return yield initialVal;\n            }\n            const waterfall = new tapable_1.AsyncSeriesWaterfallHook(['arg']);\n            if (hooks.length) {\n                const resArr = [];\n                for (const hook of hooks) {\n                    waterfall.tapPromise({\n                        name: hook.plugin,\n                        stage: hook.stage || 0,\n                        // @ts-ignore\n                        before: hook.before\n                    }, (arg) => __awaiter(this, void 0, void 0, function* () {\n                        const res = yield hook.fn(opts, arg);\n                        if (constants_1.IS_MODIFY_HOOK.test(name) && constants_1.IS_EVENT_HOOK.test(name)) {\n                            return res;\n                        }\n                        if (constants_1.IS_ADD_HOOK.test(name)) {\n                            resArr.push(res);\n                            return resArr;\n                        }\n                        return null;\n                    }));\n                }\n            }\n            return yield waterfall.promise(initialVal);\n        });\n    }\n    runWithPlatform(platform) {\n        if (!this.platforms.has(platform)) {\n            throw new Error(`‰∏çÂ≠òÂú®ÁºñËØëÂπ≥Âè∞ ${platform}`);\n        }\n        const config = this.platforms.get(platform);\n        const withNameConfig = this.config.getConfigWithNamed(config.name, config.useConfigName);\n        process.env.TARO_PLATFORM = (0, shared_1.getPlatformType)(config.name, config.useConfigName);\n        return withNameConfig;\n    }\n    setRunOpts(opts) {\n        this.runOpts = opts;\n    }\n    runHelp(name) {\n        const command = this.commands.get(name);\n        const defaultOptionsMap = new Map();\n        defaultOptionsMap.set('-h, --help', 'output usage information');\n        let customOptionsMap = new Map();\n        if (command === null || command === void 0 ? void 0 : command.optionsMap) {\n            customOptionsMap = new Map(Object.entries(command === null || command === void 0 ? void 0 : command.optionsMap));\n        }\n        const optionsMap = new Map([...customOptionsMap, ...defaultOptionsMap]);\n        (0, utils_1.printHelpLog)(name, optionsMap, (command === null || command === void 0 ? void 0 : command.synopsisList) ? new Set(command === null || command === void 0 ? void 0 : command.synopsisList) : new Set());\n    }\n    run(args) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function* () {\n            let name;\n            let opts;\n            if (typeof args === 'string') {\n                name = args;\n            }\n            else {\n                name = args.name;\n                opts = args.opts;\n            }\n            this.debugger('command:run');\n            this.debugger(`command:run:name:${name}`);\n            this.debugger('command:runOpts');\n            this.debugger(`command:runOpts:${JSON.stringify(opts, null, 2)}`);\n            this.setRunOpts(opts);\n            this.debugger('initPresetsAndPlugins');\n            this.initPresetsAndPlugins();\n            yield this.applyPlugins('onReady');\n            this.debugger('command:onStart');\n            yield this.applyPlugins('onStart');\n            if (!this.commands.has(name)) {\n                throw new Error(`${name} ÂëΩ‰ª§‰∏çÂ≠òÂú®`);\n            }\n            if (opts === null || opts === void 0 ? void 0 : opts.isHelp) {\n                return this.runHelp(name);\n            }\n            if ((_a = opts === null || opts === void 0 ? void 0 : opts.options) === null || _a === void 0 ? void 0 : _a.platform) {\n                opts.config = this.runWithPlatform(opts.options.platform);\n                yield this.applyPlugins({\n                    name: 'modifyRunnerOpts',\n                    opts: {\n                        opts: opts === null || opts === void 0 ? void 0 : opts.config\n                    }\n                });\n            }\n            yield this.applyPlugins({\n                name,\n                opts\n            });\n        });\n    }\n}\nexports.default = Kernel;\n//# sourceMappingURL=Kernel.js.map","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst helper_1 = require(\"@tarojs/helper\");\nclass Plugin {\n    constructor(opts) {\n        this.id = opts.id;\n        this.path = opts.path;\n        this.ctx = opts.ctx;\n    }\n    register(hook) {\n        if (typeof hook.name !== 'string') {\n            throw new Error(`Êèí‰ª∂ ${this.id} ‰∏≠Ê≥®ÂÜå hook Â§±Ë¥•Ôºå hook.name ÂøÖÈ°ªÊòØ string Á±ªÂûã`);\n        }\n        if (typeof hook.fn !== 'function') {\n            throw new Error(`Êèí‰ª∂ ${this.id} ‰∏≠Ê≥®ÂÜå hook Â§±Ë¥•Ôºå hook.fn ÂøÖÈ°ªÊòØ function Á±ªÂûã`);\n        }\n        const hooks = this.ctx.hooks.get(hook.name) || [];\n        hook.plugin = this.id;\n        this.ctx.hooks.set(hook.name, hooks.concat(hook));\n    }\n    registerCommand(command) {\n        if (this.ctx.commands.has(command.name)) {\n            throw new Error(`ÂëΩ‰ª§ ${command.name} Â∑≤Â≠òÂú®`);\n        }\n        this.ctx.commands.set(command.name, command);\n        this.register(command);\n    }\n    registerPlatform(platform) {\n        if (this.ctx.platforms.has(platform.name)) {\n            throw new Error(`ÈÄÇÈÖçÂπ≥Âè∞ ${platform.name} Â∑≤Â≠òÂú®`);\n        }\n        (0, helper_1.addPlatforms)(platform.name);\n        this.ctx.platforms.set(platform.name, platform);\n        this.register(platform);\n    }\n    registerMethod(...args) {\n        const { name, fn } = processArgs(args);\n        const methods = this.ctx.methods.get(name) || [];\n        methods.push(fn || function (fn) {\n            this.register({\n                name,\n                fn\n            });\n        }.bind(this));\n        this.ctx.methods.set(name, methods);\n    }\n    addPluginOptsSchema(schema) {\n        this.optsSchema = schema;\n    }\n}\nexports.default = Plugin;\nfunction processArgs(args) {\n    let name, fn;\n    if (!args.length) {\n        throw new Error('ÂèÇÊï∞‰∏∫Á©∫');\n    }\n    else if (args.length === 1) {\n        if (typeof args[0] === 'string') {\n            name = args[0];\n        }\n        else {\n            name = args[0].name;\n            fn = args[0].fn;\n        }\n    }\n    else {\n        name = args[0];\n        fn = args[1];\n    }\n    return { name, fn };\n}\n//# sourceMappingURL=Plugin.js.map","\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./mini\"), exports);\n__exportStar(require(\"./web\"), exports);\n//# sourceMappingURL=index.js.map","\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TaroPlatformBase = void 0;\nconst helper_1 = require(\"@tarojs/helper\");\nconst shared_1 = require(\"@tarojs/shared\");\nconst path = require(\"path\");\nconst package_1 = require(\"../utils/package\");\nconst platform_1 = require(\"./platform\");\nclass TaroPlatformBase extends platform_1.default {\n    constructor() {\n        super(...arguments);\n        this.platformType = shared_1.PLATFORM_TYPE.MINI;\n    }\n    /**\n     * 1. Ê∏ÖÁ©∫ dist Êñá‰ª∂Â§π\n     * 2. ËæìÂá∫ÁºñËØëÊèêÁ§∫\n     * 3. ÁîüÊàê project.config.json\n     */\n    setup() {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.setupTransaction.perform(this.setupImpl, this);\n            (_b = (_a = this.ctx).onSetupClose) === null || _b === void 0 ? void 0 : _b.call(_a, this);\n        });\n    }\n    setupImpl() {\n        var _a, _b;\n        const { output } = this.config;\n        // webpack5 ÂéüÁîüÊîØÊåÅ output.clean ÈÄâÈ°πÔºå‰ΩÜÊòØ webpack4 ‰∏çÊîØÊåÅÔºå ‰∏∫Áªü‰∏ÄË°å‰∏∫ÔºåËøôÈáåÂÅö‰∏Ä‰∏ãÂÖºÂÆπ\n        // ÔºàÂú® packages/taro-mini-runner/src/webpack/chain.ts Âíå packages/taro-webpack-runner/src/utils/chain.ts ÁöÑ makeConfig ‰∏≠ÂØπ clean ÈÄâÈ°πÂÅö‰∫ÜËøáÊª§Ôºâ\n        // ‰ªÖ output.clean ‰∏∫ false Êó∂‰∏çÊ∏ÖÁ©∫ËæìÂá∫ÁõÆÂΩï\n        // eslint-disable-next-line eqeqeq\n        if (output == undefined || output.clean == undefined || output.clean === true) {\n            this.emptyOutputDir();\n        }\n        else if ((0, shared_1.isObject)(output.clean)) {\n            this.emptyOutputDir(output.clean.keep || []);\n        }\n        this.printDevelopmentTip(this.platform);\n        if (this.projectConfigJson) {\n            this.generateProjectConfig(this.projectConfigJson);\n        }\n        if (((_a = this.ctx.initialConfig.logger) === null || _a === void 0 ? void 0 : _a.quiet) === false) {\n            const { printLog, processTypeEnum } = this.ctx.helper;\n            printLog(\"start\" /* processTypeEnum.START */, 'ÂºÄÂèëËÄÖÂ∑•ÂÖ∑-È°πÁõÆÁõÆÂΩï', `${this.ctx.paths.outputPath}`);\n        }\n        // Webpack5 ‰ª£Á†ÅËá™Âä®ÁÉ≠ÈáçËΩΩ\n        if (this.compiler === 'webpack5' && this.config.isWatch && this.projectConfigJsonOutputPath) {\n            try {\n                const projectConfig = require(this.projectConfigJsonOutputPath);\n                if (((_b = projectConfig.setting) === null || _b === void 0 ? void 0 : _b.compileHotReLoad) === true) {\n                    this.ctx.modifyWebpackChain(({ chain }) => {\n                        chain.plugin('TaroMiniHMRPlugin')\n                            .use(require(path.join(__dirname, './webpack/hmr-plugin.js')).default);\n                    });\n                }\n            }\n            catch (e) { } // eslint-disable-line no-empty\n        }\n    }\n    printDevelopmentTip(platform) {\n        var _a;\n        const tips = [];\n        const config = this.config;\n        const { chalk } = this.helper;\n        if (process.env.NODE_ENV !== 'production' && process.env.NODE_ENV !== 'test') {\n            const { isWindows } = this.helper;\n            const exampleCommand = isWindows\n                ? `$ set NODE_ENV=production && taro build --type ${platform} --watch`\n                : `$ NODE_ENV=production taro build --type ${platform} --watch`;\n            tips.push(chalk.yellowBright(`È¢ÑËßàÊ®°ÂºèÁîüÊàêÁöÑÊñá‰ª∂ËæÉÂ§ßÔºåËÆæÁΩÆ NODE_ENV ‰∏∫ production ÂèØ‰ª•ÂºÄÂêØÂéãÁº©„ÄÇ\nExample:\n${exampleCommand}`));\n        }\n        if (this.compiler === 'webpack5' && !((_a = config.cache) === null || _a === void 0 ? void 0 : _a.enable)) {\n            tips.push(chalk.yellowBright('Âª∫ËÆÆÂºÄÂêØÊåÅ‰πÖÂåñÁºìÂ≠òÂäüËÉΩÔºåËÉΩÊúâÊïàÊèêÂçá‰∫åÊ¨°ÁºñËØëÈÄüÂ∫¶ÔºåËØ¶ÊÉÖËØ∑ÂèÇËÄÉ: https://docs.taro.zone/docs/config-detail#cache„ÄÇ'));\n        }\n        if (tips.length) {\n            console.log(chalk.yellowBright('Tips:'));\n            tips.forEach((item, index) => console.log(`${chalk.yellowBright(index + 1)}. ${item}`));\n            console.log('\\n');\n        }\n    }\n    /**\n     * ËøîÂõûÂΩìÂâçÈ°πÁõÆÂÜÖÁöÑ @tarojs/mini-runner ÂåÖ\n     */\n    getRunner() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { appPath } = this.ctx.paths;\n            const { npm } = this.helper;\n            let runnerPkg;\n            switch (this.compiler) {\n                case 'webpack5':\n                    runnerPkg = '@tarojs/webpack5-runner';\n                    break;\n                default:\n                    runnerPkg = '@tarojs/mini-runner';\n            }\n            const runner = yield npm.getNpmPkg(runnerPkg, appPath);\n            return runner.bind(null, appPath);\n        });\n    }\n    /**\n     * ÂáÜÂ§á mini-runner ÂèÇÊï∞\n     * @param extraOptions ÈúÄË¶ÅÈ¢ùÂ§ñÂêàÂÖ• Options ÁöÑÈÖçÁΩÆÈ°π\n     */\n    getOptions(extraOptions = {}) {\n        const { ctx, globalObject, fileType, template } = this;\n        const config = (0, helper_1.recursiveMerge)(Object.assign({}, this.config), {\n            env: {\n                FRAMEWORK: JSON.stringify(this.config.framework),\n                TARO_ENV: JSON.stringify(this.platform),\n                TARO_PLATFORM: JSON.stringify(this.platformType),\n                TARO_VERSION: JSON.stringify((0, package_1.getPkgVersion)())\n            }\n        });\n        return Object.assign(Object.assign(Object.assign({}, config), { nodeModulesPath: ctx.paths.nodeModulesPath, buildAdapter: config.platform, platformType: this.platformType, globalObject,\n            fileType,\n            template }), extraOptions);\n    }\n    /**\n     * Ë∞ÉÁî® mini-runner ÂºÄÂßãÁºñËØë\n     * @param extraOptions ÈúÄË¶ÅÈ¢ùÂ§ñ‰º†ÂÖ• @tarojs/mini-runner ÁöÑÈÖçÁΩÆÈ°π\n     */\n    build(extraOptions = {}) {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function* () {\n            (_b = (_a = this.ctx).onBuildInit) === null || _b === void 0 ? void 0 : _b.call(_a, this);\n            yield this.buildTransaction.perform(this.buildImpl, this, extraOptions);\n        });\n    }\n    buildImpl(extraOptions = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const runner = yield this.getRunner();\n            const options = this.getOptions(Object.assign({\n                runtimePath: this.runtimePath,\n                taroComponentsPath: this.taroComponentsPath\n            }, extraOptions));\n            yield runner(options);\n        });\n    }\n    /**\n     * ÁîüÊàê project.config.json\n     * @param src È°πÁõÆÊ∫êÁ†Å‰∏≠ÈÖçÁΩÆÊñá‰ª∂ÁöÑÂêçÁß∞\n     * @param dist ÁºñËØëÂêéÈÖçÁΩÆÊñá‰ª∂ÁöÑÂêçÁß∞ÔºåÈªòËÆ§‰∏∫ 'project.config.json'\n     */\n    generateProjectConfig(src, dist = 'project.config.json') {\n        if (this.config.isBuildNativeComp)\n            return;\n        this.ctx.generateProjectConfig({\n            srcConfigName: src,\n            distConfigName: dist\n        });\n        this.projectConfigJsonOutputPath = `${this.ctx.paths.outputPath}/${dist}`;\n    }\n    /**\n     * ÈÄíÂΩíÊõøÊç¢ÂØπË±°ÁöÑ key ÂÄº\n     */\n    recursiveReplaceObjectKeys(obj, keyMap) {\n        Object.keys(obj).forEach((key) => {\n            if (keyMap[key]) {\n                obj[keyMap[key]] = obj[key];\n                if (typeof obj[key] === 'object') {\n                    this.recursiveReplaceObjectKeys(obj[keyMap[key]], keyMap);\n                }\n                delete obj[key];\n            }\n            else if (keyMap[key] === false) {\n                delete obj[key];\n            }\n            else if (typeof obj[key] === 'object') {\n                this.recursiveReplaceObjectKeys(obj[key], keyMap);\n            }\n        });\n    }\n    /**\n     * Ë∞ÉÁî® mini-runner ÂºÄÂêØÁºñËØë\n     */\n    start() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.setup();\n            yield this.build();\n        });\n    }\n}\nexports.TaroPlatformBase = TaroPlatformBase;\n//# sourceMappingURL=mini.js.map","\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.printPkgVersion = exports.getPkgVersion = exports.getRootPath = void 0;\n/* eslint-disable no-console */\nconst path = require(\"path\");\nfunction getRootPath() {\n    return path.resolve(__dirname, '../../');\n}\nexports.getRootPath = getRootPath;\nfunction getPkgVersion() {\n    return require(path.join(getRootPath(), 'package.json')).version;\n}\nexports.getPkgVersion = getPkgVersion;\nfunction printPkgVersion() {\n    console.log(`üëΩ Taro v${getPkgVersion()}`);\n    console.log();\n}\nexports.printPkgVersion = printPkgVersion;\n//# sourceMappingURL=package.js.map","\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Transaction = void 0;\nclass Transaction {\n    constructor() {\n        this.wrappers = [];\n    }\n    perform(fn, scope, ...args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.initAll(scope);\n            yield fn.call(scope, ...args);\n            this.closeAll(scope);\n        });\n    }\n    initAll(scope) {\n        const wrappers = this.wrappers;\n        wrappers.forEach(wrapper => { var _a; return (_a = wrapper.init) === null || _a === void 0 ? void 0 : _a.call(scope); });\n    }\n    closeAll(scope) {\n        const wrappers = this.wrappers;\n        wrappers.forEach(wrapper => { var _a; return (_a = wrapper.close) === null || _a === void 0 ? void 0 : _a.call(scope); });\n    }\n    addWrapper(wrapper) {\n        this.wrappers.push(wrapper);\n    }\n}\nexports.Transaction = Transaction;\nclass TaroPlatform {\n    constructor(ctx, config) {\n        this.setupTransaction = new Transaction();\n        this.buildTransaction = new Transaction();\n        this.ctx = ctx;\n        this.helper = ctx.helper;\n        this.config = config;\n        this.updateOutputPath(config);\n        const _compiler = config.compiler;\n        this.compiler = typeof _compiler === 'object' ? _compiler.type : _compiler;\n    }\n    emptyOutputDir(excludes = []) {\n        const { outputPath } = this.ctx.paths;\n        this.helper.emptyDirectory(outputPath, { excludes });\n    }\n    /**\n     * Â¶ÇÊûúÂàÜÁ´ØÁºñËØëËØ¶ÊÉÖ webpack ÈÖçÁΩÆ‰∫Ü output ÂàôÈúÄÊõ¥Êñ∞ outputPath ‰ΩçÁΩÆ\n     */\n    updateOutputPath(config) {\n        var _a;\n        const platformPath = (_a = config.output) === null || _a === void 0 ? void 0 : _a.path;\n        if (platformPath) {\n            this.ctx.paths.outputPath = platformPath;\n        }\n    }\n}\nexports.default = TaroPlatform;\n//# sourceMappingURL=platform.js.map","\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TaroPlatformWeb = void 0;\nconst shared_1 = require(\"@tarojs/shared\");\nconst lodash_1 = require(\"lodash\");\nconst path = require(\"path\");\nconst package_1 = require(\"../utils/package\");\nconst platform_1 = require(\"./platform\");\nclass TaroPlatformWeb extends platform_1.default {\n    constructor() {\n        super(...arguments);\n        this.platformType = shared_1.PLATFORM_TYPE.WEB;\n    }\n    /**\n     * 1. Ê∏ÖÁ©∫ dist Êñá‰ª∂Â§π\n     * 2. ËæìÂá∫ÁºñËØëÊèêÁ§∫\n     */\n    setup() {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.setupTransaction.perform(this.setupWebApp, this);\n            (_b = (_a = this.ctx).onSetupClose) === null || _b === void 0 ? void 0 : _b.call(_a, this);\n        });\n    }\n    setupWebApp() {\n        const { output } = this.config;\n        // webpack5 ÂéüÁîüÊîØÊåÅ output.clean ÈÄâÈ°πÔºå‰ΩÜÊòØ webpack4 ‰∏çÊîØÊåÅÔºå ‰∏∫Áªü‰∏ÄË°å‰∏∫ÔºåËøôÈáåÂÅö‰∏Ä‰∏ãÂÖºÂÆπ\n        // ÔºàÂú® packages/taro-mini-runner/src/webpack/chain.ts Âíå packages/taro-webpack-runner/src/utils/chain.ts ÁöÑ makeConfig ‰∏≠ÂØπ clean ÈÄâÈ°πÂÅö‰∫ÜËøáÊª§Ôºâ\n        // eslint-disable-next-line eqeqeq\n        if (output == undefined || output.clean == undefined || output.clean === true) {\n            this.emptyOutputDir();\n        }\n        else if ((0, shared_1.isObject)(output.clean)) {\n            this.emptyOutputDir(output.clean.keep || []);\n        }\n        this.printDevelopmentTip();\n    }\n    printDevelopmentTip() {\n        var _a;\n        const tips = [];\n        const config = this.config;\n        const { chalk } = this.helper;\n        if (this.compiler === 'webpack5' && !((_a = config.cache) === null || _a === void 0 ? void 0 : _a.enable)) {\n            tips.push(chalk.yellowBright('Âª∫ËÆÆÂºÄÂêØÊåÅ‰πÖÂåñÁºìÂ≠òÂäüËÉΩÔºåËÉΩÊúâÊïàÊèêÂçá‰∫åÊ¨°ÁºñËØëÈÄüÂ∫¶ÔºåËØ¶ÊÉÖËØ∑ÂèÇËÄÉ: https://docs.taro.zone/docs/config-detail#cache„ÄÇ'));\n        }\n        if (tips.length) {\n            console.log(chalk.yellowBright('Tips:'));\n            tips.forEach((item, index) => console.log(`${chalk.yellowBright(index + 1)}. ${item}`));\n            console.log('\\n');\n        }\n    }\n    /**\n     * ËøîÂõûÂΩìÂâçÈ°πÁõÆÂÜÖÁöÑ runner ÂåÖ\n     */\n    getRunner() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { appPath } = this.ctx.paths;\n            const { npm } = this.helper;\n            let runnerPkg;\n            switch (this.compiler) {\n                case 'webpack5':\n                    runnerPkg = '@tarojs/webpack5-runner';\n                    break;\n                default:\n                    runnerPkg = '@tarojs/webpack-runner';\n            }\n            const runner = yield npm.getNpmPkg(runnerPkg, appPath);\n            return runner.bind(null, appPath);\n        });\n    }\n    /**\n     * ÂáÜÂ§á runner ÂèÇÊï∞\n     * @param extraOptions ÈúÄË¶ÅÈ¢ùÂ§ñÂêàÂÖ• Options ÁöÑÈÖçÁΩÆÈ°π\n     */\n    getOptions(extraOptions = {}) {\n        const { sourcePath } = this.ctx.paths;\n        const { initialConfig } = this.ctx;\n        const { port } = this.ctx.runOpts.options;\n        const { recursiveMerge, ENTRY, SOURCE_DIR, OUTPUT_DIR } = this.ctx.helper;\n        const entryFileName = `${ENTRY}.config`;\n        const entryFile = path.basename(entryFileName);\n        const defaultEntry = {\n            [ENTRY]: [path.join(sourcePath, entryFile)]\n        };\n        const customEntry = (0, lodash_1.get)(initialConfig, 'h5.entry');\n        const config = recursiveMerge(Object.assign({}, this.config), {\n            entryFileName: ENTRY,\n            env: {\n                FRAMEWORK: JSON.stringify(this.config.framework),\n                TARO_ENV: JSON.stringify(this.platform),\n                TARO_PLATFORM: JSON.stringify(this.platformType),\n                TARO_VERSION: JSON.stringify((0, package_1.getPkgVersion)())\n            },\n            devServer: { port },\n            sourceRoot: this.config.sourceRoot || SOURCE_DIR,\n            outputRoot: this.config.outputRoot || OUTPUT_DIR\n        });\n        config.entry = (0, lodash_1.merge)(defaultEntry, customEntry);\n        return Object.assign(Object.assign(Object.assign({}, config), { buildAdapter: config.platform, platformType: this.platformType }), extraOptions);\n    }\n    /**\n     * Ë∞ÉÁî® runner ÂºÄÂßãÁºñËØë\n     * @param extraOptions ÈúÄË¶ÅÈ¢ùÂ§ñ‰º†ÂÖ• runner ÁöÑÈÖçÁΩÆÈ°π\n     */\n    build(extraOptions = {}) {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function* () {\n            (_b = (_a = this.ctx).onBuildInit) === null || _b === void 0 ? void 0 : _b.call(_a, this);\n            yield this.buildTransaction.perform(this.buildWebApp, this, extraOptions);\n        });\n    }\n    buildWebApp(extraOptions = {}) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const runner = yield this.getRunner();\n            const options = this.getOptions(Object.assign({\n                runtimePath: this.runtimePath,\n            }, extraOptions));\n            yield runner(options);\n        });\n    }\n    /**\n     * Ë∞ÉÁî® runner ÂºÄÂêØÁºñËØë\n     */\n    start() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.setup();\n            yield this.build();\n        });\n    }\n}\nexports.TaroPlatformWeb = TaroPlatformWeb;\n//# sourceMappingURL=web.js.map","\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map"]}